<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EdClub Competitor Intel</title>
    <style>
        :root {
            --bg: #0f172a;
            --surface: #1e293b;
            --surface-hover: #334155;
            --border: #475569;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --accent: #f472b6;
            --accent-secondary: #38bdf8;
            --success: #22c55e;
            --warning: #fbbf24;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 2rem;
        }
        
        .container { max-width: 1600px; margin: 0 auto; }
        
        h1 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .subtitle { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1.5rem; }
        
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat {
            background: var(--surface);
            padding: 1.25rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            text-align: center;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1;
        }
        
        .stat-value.pink { color: var(--accent); }
        .stat-value.blue { color: var(--accent-secondary); }
        .stat-value.yellow { color: var(--warning); }
        .stat-value.green { color: var(--success); }
        
        .stat-label {
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.35rem;
        }
        
        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .controls select, .controls input {
            padding: 0.6rem 1rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 0.9rem;
        }
        
        .controls input { flex: 1; min-width: 250px; }
        
        .export-btn {
            padding: 0.6rem 1.25rem;
            background: #dc2626;
            border: none;
            border-radius: 6px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            margin-left: auto;
        }
        
        .export-btn:hover { background: #ef4444; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--surface);
            border-radius: 8px;
            overflow: hidden;
        }
        
        th {
            background: var(--bg);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--text-muted);
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
        }
        
        th:hover { color: var(--text); }
        th.sorted { color: var(--accent); }
        th.sorted::after { content: ' ‚Üë'; }
        th.sorted.desc::after { content: ' ‚Üì'; }
        
        td {
            padding: 0.85rem 1rem;
            border-top: 1px solid var(--border);
            font-size: 0.9rem;
        }
        
        tr:hover { background: var(--surface-hover); }
        
        .name-cell { font-weight: 500; }
        
        .subdomain-link {
            color: var(--accent-secondary);
            text-decoration: none;
            font-size: 0.85rem;
        }
        
        .subdomain-link:hover { text-decoration: underline; }
        .subdomain-link.edclub { color: #f472b6; font-size: 0.8rem; }
        .dead { color: #ef4444; font-size: 0.75rem; }
        
        .date-cell { white-space: nowrap; }
        .date-cell.recent { color: var(--success); font-weight: 500; }
        .date-cell .dot { 
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            margin-left: 0.5rem;
        }
        
        .badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            background: var(--border);
        }
        
        .badge.yes { background: rgba(34, 197, 94, 0.2); color: var(--success); }
        .badge.no { background: var(--border); color: var(--text-muted); }
        
        .type-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .type-district { background: #1d4ed8; color: white; }
        .type-elementary { background: #059669; color: white; }
        .type-middle { background: #7c3aed; color: white; }
        .type-high-school { background: #dc2626; color: white; }
        .type-charter { background: #ea580c; color: white; }
        .type-private { background: #0891b2; color: white; }
        .type-other { background: var(--border); color: var(--text); }
        
        .empty { text-align: center; padding: 3rem; color: var(--text-muted); }
        
        footer {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 0.8rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚öîÔ∏è EdClub Competitor Intel</h1>
        <p class="subtitle"><span id="totalCount">--</span> schools/districts using TypingClub/EdClub ‚Äî identified via DNS enumeration</p>
        
        <div class="stats-bar">
            <div class="stat">
                <div class="stat-value pink" id="statTotal">--</div>
                <div class="stat-label">Total EdClub Customers</div>
            </div>
            <div class="stat">
                <div class="stat-value blue" id="statActive">--</div>
                <div class="stat-label">üü¢ Active in 2026</div>
            </div>
            <div class="stat">
                <div class="stat-value yellow" id="statEstablished">--</div>
                <div class="stat-label">‚úÖ Validated</div>
            </div>
            <div class="stat">
                <div class="stat-value green" id="statNew">--</div>
                <div class="stat-label">‚ö†Ô∏è Dead/Invalid</div>
            </div>
        </div>
        
        <div class="controls">
            <select id="typeFilter">
                <option value="">Type: All</option>
                <option value="District">Districts</option>
                <option value="Elementary">Elementary</option>
                <option value="Middle">Middle Schools</option>
                <option value="High School">High Schools</option>
                <option value="Charter">Charter/Academy</option>
                <option value="Private">Private/Religious</option>
                <option value="Other">Other</option>
            </select>
            <select id="matchFilter">
                <option value="">Match: All</option>
                <option value="yes">Matched</option>
                <option value="no">Not Matched</option>
            </select>
            <select id="activityFilter">
                <option value="">Activity: All</option>
                <option value="active">Active (2026)</option>
                <option value="recent">Recent (2025+)</option>
                <option value="stale">Stale (pre-2025)</option>
            </select>
            <input type="text" id="searchInput" placeholder="Search by name or subdomain...">
            <button class="export-btn" onclick="exportCSV()">üì• Export CSV</button>
        </div>
        
        <table>
            <thead>
                <tr>
                    <th data-sort="name" class="sorted">Customer Name</th>
                    <th data-sort="subdomain">Subdomain</th>
                    <th data-sort="type">Type</th>
                    <th data-sort="firstSeen">First Seen</th>
                    <th data-sort="lastSeen">Last Seen</th>
                    <th data-sort="matched">Matched</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <tr><td colspan="6" class="empty">Loading...</td></tr>
            </tbody>
        </table>
        
        <footer>
            <p>Data: RapidDNS subdomain enumeration + Wayback Machine historical data</p>
        </footer>
    </div>
    
    <script>
        let data = [];
        let sortCol = 'name';
        let sortAsc = true;
        
        function categorize(name) {
            const lower = (name || '').toLowerCase();
            if (lower.includes('usd') || lower.includes('isd') || lower.includes('district') || lower.includes('csd') || lower.includes('unified') || lower.includes('county school') || lower.includes('schools')) {
                return 'District';
            }
            if (lower.includes('elementary') || lower.includes('-el') || lower.includes('elem') || lower.includes('primary')) {
                return 'Elementary';
            }
            if (lower.includes('middle') || lower.includes('junior') || lower.includes('-ms') || lower.includes('-jh') || lower.includes('intermediate')) {
                return 'Middle';
            }
            if (lower.includes('high') || lower.includes('-hs') || lower.includes('senior') || lower.includes('secondary')) {
                return 'High School';
            }
            if (lower.includes('charter') || lower.includes('academy') || lower.includes('magnet')) {
                return 'Charter';
            }
            if (lower.includes('catholic') || lower.includes('christian') || lower.includes('lutheran') || 
                lower.includes('st.') || lower.includes('saint') || lower.includes('holy') || lower.includes('sacred') ||
                lower.includes('jewish') || lower.includes('day school') || lower.includes('parish')) {
                return 'Private';
            }
            return 'Other';
        }
        
        async function loadData() {
            try {
                const resp = await fetch('enriched-data.json?t=' + Date.now());
                data = await resp.json();
                updateStats();
                render();
            } catch (e) {
                console.error(e);
            }
        }
        
        function updateStats() {
            const total = data.length;
            const active2026 = data.filter(d => d.lastSeen && d.lastSeen >= '2026-01-01').length;
            const validated = data.filter(d => d.validDomains).length;
            const bothDomains = data.filter(d => d.validDomains === 'both').length;
            const dead = data.filter(d => d.validDomains === 'none').length;
            
            document.getElementById('statTotal').textContent = total.toLocaleString();
            document.getElementById('totalCount').textContent = total.toLocaleString();
            document.getElementById('statActive').textContent = active2026.toLocaleString();
            document.getElementById('statEstablished').textContent = validated.toLocaleString();
            document.getElementById('statNew').textContent = (validated > 0 ? dead : 0).toLocaleString();
        }
        
        function getFilteredData() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const typeFilter = document.getElementById('typeFilter').value;
            const matchFilter = document.getElementById('matchFilter').value;
            const activityFilter = document.getElementById('activityFilter').value;
            
            return data.filter(d => {
                const name = (d.schoolName || d.subdomain).toLowerCase();
                if (search && !name.includes(search) && !d.subdomain.includes(search)) return false;
                
                // Type filter
                if (typeFilter && categorize(d.schoolName || d.subdomain) !== typeFilter) return false;
                
                // Match filter - placeholder for now
                if (matchFilter === 'yes' && !d.matched) return false;
                if (matchFilter === 'no' && d.matched) return false;
                
                // Activity filter
                if (activityFilter === 'active' && (!d.lastSeen || d.lastSeen < '2026-01-01')) return false;
                if (activityFilter === 'recent' && (!d.lastSeen || d.lastSeen < '2025-01-01')) return false;
                if (activityFilter === 'stale' && d.lastSeen && d.lastSeen >= '2025-01-01') return false;
                
                return true;
            });
        }
        
        function sortData(filtered) {
            return filtered.sort((a, b) => {
                let valA, valB;
                switch (sortCol) {
                    case 'name':
                        valA = (a.schoolName || a.subdomain).toLowerCase();
                        valB = (b.schoolName || b.subdomain).toLowerCase();
                        break;
                    case 'subdomain':
                        valA = a.subdomain;
                        valB = b.subdomain;
                        break;
                    case 'firstSeen':
                        valA = a.firstSeen || '';
                        valB = b.firstSeen || '';
                        break;
                    case 'lastSeen':
                        valA = a.lastSeen || '';
                        valB = b.lastSeen || '';
                        break;
                    case 'matched':
                        valA = a.matched ? 1 : 0;
                        valB = b.matched ? 1 : 0;
                        break;
                    case 'type':
                        valA = categorize(a.schoolName || a.subdomain);
                        valB = categorize(b.schoolName || b.subdomain);
                        break;
                    default:
                        valA = valB = '';
                }
                if (valA < valB) return sortAsc ? -1 : 1;
                if (valA > valB) return sortAsc ? 1 : -1;
                return 0;
            });
        }
        
        function render() {
            const filtered = sortData(getFilteredData());
            const tbody = document.getElementById('tableBody');
            
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="empty">No matching customers</td></tr>';
                return;
            }
            
            tbody.innerHTML = filtered.map(d => {
                const displayName = d.schoolName || formatName(d.subdomain);
                const isActive2026 = d.lastSeen && d.lastSeen >= '2026-01-01';
                const type = categorize(d.schoolName || d.subdomain);
                const typeClass = type.toLowerCase().replace(' ', '-');
                
                return `
                    <tr>
                        <td class="name-cell">${escapeHtml(displayName)}</td>
                        <td>
                            ${d.typingclubValid !== false ? `<a class="subdomain-link" href="https://${d.subdomain}.typingclub.com" target="_blank">${d.subdomain}.typingclub.com</a>` : ''}
                            ${d.typingclubValid !== false && d.edclubValid !== false ? '<br>' : ''}
                            ${d.edclubValid !== false ? `<a class="subdomain-link edclub" href="https://${d.subdomain}.edclub.com" target="_blank">${d.subdomain}.edclub.com</a>` : ''}
                            ${d.validDomains === 'none' ? '<span class="dead">‚ö†Ô∏è Invalid</span>' : ''}
                        </td>
                        <td><span class="type-badge type-${typeClass}">${type}</span></td>
                        <td class="date-cell">${d.firstSeen || '-'}</td>
                        <td class="date-cell ${isActive2026 ? 'recent' : ''}">${d.lastSeen || '-'}${isActive2026 ? '<span class="dot"></span>' : ''}</td>
                        <td><span class="badge ${d.matched ? 'yes' : 'no'}">${d.matched ? 'Yes' : 'No'}</span></td>
                    </tr>
                `;
            }).join('');
        }
        
        function formatName(subdomain) {
            return subdomain
                .replace(/-/g, ' ')
                .replace(/\d+$/, '')
                .split(' ')
                .map(w => w.charAt(0).toUpperCase() + w.slice(1))
                .join(' ')
                .trim();
        }
        
        function escapeHtml(str) {
            return str.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
        }
        
        function exportCSV() {
            const filtered = sortData(getFilteredData());
            const headers = ['Customer Name', 'Subdomain', 'Type', 'URL', 'First Seen', 'Last Seen', 'Matched'];
            const rows = filtered.map(d => [
                d.schoolName || formatName(d.subdomain),
                d.subdomain,
                categorize(d.schoolName || d.subdomain),
                `https://${d.subdomain}.typingclub.com`,
                d.firstSeen || '',
                d.lastSeen || '',
                d.matched ? 'Yes' : 'No'
            ]);
            
            const csv = [headers, ...rows].map(r => r.map(c => `"${(c+'').replace(/"/g, '""')}"`).join(',')).join('\n');
            const blob = new Blob([csv], {type: 'text/csv'});
            const a = document.createElement('a');
a.href = URL.createObjectURL(blob);
            a.download = 'edclub-customers.csv';
            a.click();
        }
        
        // Sorting
        document.querySelectorAll('th[data-sort]').forEach(th => {
            th.addEventListener('click', () => {
                const col = th.dataset.sort;
                if (sortCol === col) {
                    sortAsc = !sortAsc;
                } else {
                    sortCol = col;
                    sortAsc = true;
                }
                document.querySelectorAll('th').forEach(t => t.classList.remove('sorted', 'desc'));
                th.classList.add('sorted');
                if (!sortAsc) th.classList.add('desc');
                render();
            });
        });
        
        // Filters
        document.getElementById('searchInput').addEventListener('input', render);
        document.getElementById('typeFilter').addEventListener('change', render);
        document.getElementById('matchFilter').addEventListener('change', render);
        document.getElementById('activityFilter').addEventListener('change', render);
        
        // Auto-refresh during enrichment
        loadData();
        setInterval(loadData, 30000);
    </script>
</body>
</html>
